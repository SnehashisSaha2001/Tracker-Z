<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Tracker Field Force | Mobile Ready</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        secondary: '#1e293b',
                        tertiary: '#334155',
                        brandNav: '#0a213a',
                        brandMain: '#223a46',
                        accent: '#00d1ff',
                        accentHover: '#00c2eb',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'slide-in-right': 'slideInRight 0.3s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* --- RESPONSIVENESS & BASE RESET --- */
        html, body { 
            margin: 0; 
            padding: 0; 
            min-height: 100dvh; 
            width: 100%; 
            background-color: #0f172a; 
            color: #f8fafc; 
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }
        
        *, *::before, *::after { box-sizing: inherit; }

        /* Map Styling */
        .leaflet-container { background: #1e293b; font-family: 'Inter', sans-serif; }
        .map-tiles-inverted { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(85%); }
        .leaflet-marker-icon, .leaflet-popup, .leaflet-tooltip, .leaflet-pane { filter: invert(0%) !important; }

        /* Custom Scrollbar for Webkit */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #00d1ff; }

        /* Form Elements - Mobile Touch Optimization */
        .modern-input {
            width: 100%;
            padding: 0.75rem 1rem; 
            min-height: 44px; 
            border-radius: 0.5rem;
            border: 1px solid #334155;
            background: #1e293b;
            color: #f1f5f9;
            outline: none;
            transition: all 0.2s;
            font-size: 1rem; 
        }
        .modern-input:focus { border-color: #00d1ff; box-shadow: 0 0 0 2px rgba(0, 209, 255, 0.2); background: #1e293b; }
        
        /* Table Styling */
        .modern-table-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 0.5rem;
        }
        .modern-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0; 
            min-width: 600px; 
        } 
        .modern-table th {
            background-color: #1e293b;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            padding: 0.75rem 1rem;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .modern-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #334155;
            color: #cbd5e1;
            background-color: transparent;
            font-size: 0.875rem;
        }
        .modern-table tr:hover td { background-color: rgba(30, 41, 59, 0.5); }

        /* Chat Bubbles */
        .bubble-me::after {
            content: ""; position: absolute; top: 0; right: -6px; width: 0; height: 0;
            border-left: 8px solid #005c4b; border-bottom: 8px solid transparent;
        }
        .bubble-them::after {
            content: ""; position: absolute; top: 0; left: -6px; width: 0; height: 0;
            border-right: 8px solid #202c33; border-bottom: 8px solid transparent;
        }
        @media (max-width: 640px) {
            .bubble-me::after, .bubble-them::after { display: none; }
        }

        /* Utilities */
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }

        /* Safe area padding for iPhone notch */
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 20px); }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom": "https://esm.sh/react-dom@^19.2.3",
    "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.89.0"
  }
}
</script>
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script type="module">
        import React, { useState, useEffect, useCallback, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { createClient } from '@supabase/supabase-js';

        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://yuuzmvjkxzwmisvxkbpk.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl1dXptdmpreHp3bWlzdnhrYnBrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyOTE4NDAsImV4cCI6MjA3OTg2Nzg0MH0.bDwJTetMoOJIh0rNuvWADtD_5VLLfW0uaPijv8Zo6O0';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- UTILS ---
        const reverseGeocode = async (lat, lng) => {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
                const data = await response.json();
                return data.display_name || `${lat.toFixed(5)}, ${lng.toFixed(5)}`;
            } catch (err) {
                console.error("Geocoding failed:", err);
                return `${lat.toFixed(5)}, ${lng.toFixed(5)}`;
            }
        };

        // --- ICONS (SVG) ---
        const Icons = {
            Dashboard: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" })),
            Activity: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" })),
            FollowUp: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" })),
            Profile: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" })),
            Users: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" })),
            Admin: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" })),
            Menu: () => React.createElement("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M4 6h16M4 12h16M4 18h16" })),
            Close: () => React.createElement("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M6 18L18 6M6 6l12 12" })),
            Map: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" })),
            ClipboardList: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" })),
            Chat: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" })),
            Send: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M12 19l9 2-9-18-9 18 9-2zm0 0v-8" })),
            Rocket: () => React.createElement("svg", { className: "w-8 h-8", fill: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { d: "M12.817 4.423a2.89 2.89 0 0 0-5.634 0L4.59 12.22a2.89 2.89 0 0 0 2.384 3.51l.001.031c.005.459.127.913.356 1.323l1.1 1.972a3.89 3.89 0 0 0 6.738 0l1.1-1.972a2.89 2.89 0 0 0 .357-1.323l.001-.03a2.89 2.89 0 0 0 2.384-3.51l-2.593-7.797ZM12 16.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Z" })),
            DoubleCheck: () => React.createElement("svg", { className: "w-3 h-3", fill: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { d: "M0 11.388L2.236 9.152l4.636 4.637 11.89-11.89L21 4.135 6.873 18.261 0 11.388zM6.873 15.656L18.763 3.766l2.237 2.236-11.89 11.89-2.237-2.236z" })),
            ChevronLeft: () => React.createElement("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M15 19l-7-7 7-7" })),
            Edit: () => React.createElement("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" })),
            Delete: () => React.createElement("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" })),
            PaperClip: () => React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" })),
            Download: () => React.createElement("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" })),
            Refresh: () => React.createElement("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" })),
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return React.createElement("div", { className: "fixed inset-0 z-[100] bg-black/80 flex items-end sm:items-center justify-center p-0 sm:p-4 backdrop-blur-sm animate-fade-in" },
                React.createElement("div", { className: "bg-secondary w-full sm:max-w-md sm:max-h-[90vh] flex flex-col sm:rounded-3xl border-t sm:border border-tertiary shadow-2xl overflow-hidden animate-slide-in h-[90vh] sm:h-auto" },
                    React.createElement("div", { className: "p-4 border-b border-tertiary flex justify-between items-center bg-primary/50 flex-shrink-0" },
                        React.createElement("h3", { className: "text-lg font-bold text-white tracking-wide truncate" }, title),
                        React.createElement("button", { onClick: onClose, className: "text-gray-400 hover:text-white transition-colors p-1" }, React.createElement(Icons.Close, null))
                    ),
                    React.createElement("div", { className: "p-4 overflow-y-auto custom-scrollbar flex-1" }, children)
                )
            );
        };

        // --- COMPONENTS ---

        // START TASK REPLY FEATURE
        const TaskReplies = ({ taskId, user, allEmployees }) => {
            const [replies, setReplies] = useState([]);
            const [loading, setLoading] = useState(false);
            const [errorConfig, setErrorConfig] = useState(null);
            const [replyText, setReplyText] = useState('');
            const [selectedFile, setSelectedFile] = useState(null);
            const [sending, setSending] = useState(false);
            const fileInputRef = useRef(null);
            const scrollRef = useRef(null);

            const fetchReplies = useCallback(async () => {
                setLoading(true);
                setErrorConfig(null);
                
                // Ensure taskId is passed as string if using .eq on potentially text columns
                const { data, error } = await supabase
                    .from('task_replies')
                    .select('*')
                    .eq('task_id', taskId)
                    .order('created_at', { ascending: true });
                
                if (error) {
                    console.error("Fetch error:", error);
                    // Detection for missing SELECT policy
                    if (error.code === '42501' || error.message.includes('security')) {
                        setErrorConfig({
                            title: "Access Denied (RLS)",
                            desc: "Replies are stored but blocked from viewing. Run this SQL in Supabase Dashboard:",
                            sql: "create policy \"Allow Public Select\" on public.task_replies for select to public using (true);"
                        });
                    } else {
                        alert("Error loading replies: " + error.message);
                    }
                } else {
                    setReplies(data || []);
                }
                setLoading(false);
            }, [taskId]);

            useEffect(() => {
                fetchReplies();
                const subscription = supabase
                    .channel(`task_replies_${taskId}`)
                    .on('postgres_changes', { 
                        event: 'INSERT', 
                        schema: 'public', 
                        table: 'task_replies', 
                        filter: `task_id=eq.${taskId}` 
                    }, payload => {
                        setReplies(prev => {
                            // Deduplicate
                            if (prev.some(r => r.id === payload.new.id)) return prev;
                            return [...prev, payload.new];
                        });
                    })
                    .subscribe();
                return () => { subscription.unsubscribe(); };
            }, [taskId, fetchReplies]);

            useEffect(() => {
                if (replies.length > 0) {
                    scrollRef.current?.scrollIntoView({ behavior: 'smooth' });
                }
            }, [replies]);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const allowedTypes = [
                    'application/pdf', 
                    'application/vnd.ms-excel', 
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                    'image/jpeg', 
                    'image/png', 
                    'image/gif'
                ];
                if (!allowedTypes.includes(file.type)) {
                    alert('Allowed file types: Image, PDF, Excel only.');
                    e.target.value = '';
                    return;
                }
                setSelectedFile(file);
            };

            const handleSend = async (e) => {
                e.preventDefault();
                if (!replyText.trim() && !selectedFile) return;
                
                setSending(true);
                let fileUrl = null;
                let fileType = null;
                let mimeType = null;
                let fileSizeKb = 0;

                try {
                    if (selectedFile) {
                        const fileExt = selectedFile.name.split('.').pop();
                        const fileName = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}.${fileExt}`;
                        const filePath = `task_replies/${taskId}/${fileName}`;
                        
                        const { error: uploadError } = await supabase.storage
                            .from('chat-uploads')
                            .upload(filePath, selectedFile, { contentType: selectedFile.type });
                        
                        if (uploadError) throw uploadError;

                        const { data: { publicUrl } } = supabase.storage
                            .from('chat-uploads')
                            .getPublicUrl(filePath);
                        
                        fileUrl = publicUrl;
                        mimeType = selectedFile.type;
                        fileSizeKb = Math.round(selectedFile.size / 1024);
                        
                        if (mimeType.includes('image')) fileType = 'image';
                        else if (mimeType.includes('pdf')) fileType = 'pdf';
                        else fileType = 'excel';
                    }

                    const { error } = await supabase.from('task_replies').insert([{
                        task_id: taskId,
                        sender_id: user.user_id,
                        message: replyText,
                        file_url: fileUrl,
                        file_type: fileType,
                        mime_type: mimeType,
                        file_size_kb: fileSizeKb,
                        created_at: new Date().toISOString()
                    }]);

                    if (error) {
                         // Detection for missing INSERT policy
                        if (error.code === '42501' || error.message.includes('security')) {
                            setErrorConfig({
                                title: "Save Denied (RLS)",
                                desc: "Your database blocks anonymous replies. Run this SQL:",
                                sql: "create policy \"Allow Public Insert\" on public.task_replies for insert to public with check (true);"
                            });
                        }
                        throw error;
                    }

                    setReplyText('');
                    setSelectedFile(null);
                    if (fileInputRef.current) fileInputRef.current.value = '';
                    // Force re-fetch in case realtime delay
                    fetchReplies();
                } catch (err) {
                    alert('Failed to send reply: ' + err.message);
                } finally {
                    setSending(false);
                }
            };

            return React.createElement("div", { className: "mt-6 pt-6 border-t border-tertiary space-y-4" },
                React.createElement("div", { className: "flex justify-between items-center" },
                    React.createElement("h4", { className: "text-sm font-bold text-gray-400 uppercase tracking-widest" }, "Replies"),
                    React.createElement("button", { onClick: fetchReplies, disabled: loading, className: "p-2 hover:bg-white/5 rounded-full text-accent transition-colors" }, 
                        React.createElement(Icons.Refresh, { className: loading ? "animate-spin" : "" })
                    )
                ),

                errorConfig && React.createElement("div", { className: "bg-danger/10 border border-danger p-3 rounded-xl space-y-2 animate-fade-in" },
                    React.createElement("h5", { className: "text-danger text-xs font-bold" }, errorConfig.title),
                    React.createElement("p", { className: "text-[10px] text-gray-300" }, errorConfig.desc),
                    React.createElement("div", { className: "bg-black/50 p-2 rounded text-[9px] font-mono text-success overflow-x-auto whitespace-nowrap" }, errorConfig.sql),
                    React.createElement("button", { onClick: () => { navigator.clipboard.writeText(errorConfig.sql); alert('SQL copied!'); }, className: "text-[9px] bg-white/10 px-2 py-1 rounded font-bold uppercase" }, "Copy SQL")
                ),
                
                React.createElement("div", { className: "space-y-3 max-h-[300px] overflow-y-auto custom-scrollbar p-1" },
                    loading && replies.length === 0 ? React.createElement("p", { className: "text-center text-xs text-gray-500 py-4" }, "Loading replies...") :
                    replies.length === 0 ? React.createElement("p", { className: "text-center text-xs text-gray-500 py-4" }, "No replies found. Try refreshing.") :
                    replies.map(r => {
                        const sender = allEmployees.find(e => e.user_id === r.sender_id);
                        const isMe = r.sender_id === user.user_id;
                        return React.createElement("div", { key: r.id, className: `flex flex-col ${isMe ? 'items-end' : 'items-start'}` },
                            React.createElement("div", { className: `max-w-[90%] p-3 rounded-2xl ${isMe ? 'bg-accent/10 border border-accent/20' : 'bg-primary/50 border border-tertiary'}` },
                                React.createElement("p", { className: "text-[10px] font-bold text-accent mb-1" }, sender?.name || r.sender_id),
                                r.file_url && React.createElement("div", { className: "mb-2" },
                                    r.file_type === 'image' ? 
                                        React.createElement("img", { src: r.file_url, className: "rounded-lg max-h-40 w-auto border border-white/5 shadow-md", alt: "Attachment" }) :
                                        React.createElement("a", { href: r.file_url, target: "_blank", rel: "noopener noreferrer", className: "flex items-center gap-2 bg-black/30 p-2 rounded-lg text-xs text-white hover:bg-black/50 transition-colors" }, 
                                            React.createElement(Icons.PaperClip, null), 
                                            React.createElement("span", { className: "truncate max-w-[120px]" }, r.file_type === 'pdf' ? 'PDF Document' : 'Excel Sheet'),
                                            React.createElement(Icons.Download, null)
                                        )
                                ),
                                r.message && React.createElement("p", { className: "text-sm text-gray-200 leading-relaxed whitespace-pre-wrap" }, r.message),
                                React.createElement("p", { className: "text-[8px] text-gray-500 mt-2 text-right" }, new Date(r.created_at).toLocaleString([], { hour: '2-digit', minute: '2-digit', day: '2-digit', month: 'short' }))
                            )
                        );
                    }),
                    React.createElement("div", { ref: scrollRef })
                ),

                React.createElement("form", { onSubmit: handleSend, className: "bg-primary/40 p-3 rounded-2xl border border-tertiary space-y-3" },
                    React.createElement("textarea", { 
                        value: replyText, 
                        onChange: e => setReplyText(e.target.value), 
                        className: "modern-input text-sm min-h-[80px] resize-none", 
                        placeholder: "Type your reply here..." 
                    }),
                    React.createElement("div", { className: "flex items-center gap-2" },
                        React.createElement("div", { className: "flex-1 relative" },
                            React.createElement("input", { 
                                type: "file", 
                                ref: fileInputRef, 
                                onChange: handleFileChange, 
                                className: "hidden" 
                            }),
                            React.createElement("button", { 
                                type: "button", 
                                onClick: () => fileInputRef.current?.click(), 
                                className: `w-full flex items-center justify-center gap-2 p-2.5 rounded-xl border border-dashed transition-all text-xs font-bold ${selectedFile ? 'border-accent text-accent bg-accent/5' : 'border-tertiary text-gray-500 hover:text-gray-300 hover:border-gray-500'}` 
                            }, 
                                React.createElement(Icons.PaperClip, null), 
                                selectedFile ? selectedFile.name : 'Attach File'
                            )
                        ),
                        React.createElement("button", { 
                            type: "submit", 
                            disabled: sending || (!replyText.trim() && !selectedFile),
                            className: "bg-accent hover:bg-accentHover disabled:opacity-50 text-brandNav font-black px-6 py-2.5 rounded-xl text-sm transition-all shadow-lg flex items-center gap-2" 
                        }, 
                            sending ? '...' : React.createElement(Icons.Send, null), 
                            "Send"
                        )
                    ),
                    React.createElement("p", { className: "text-[9px] text-gray-600 text-center" }, "Allowed: Image, PDF, Excel only")
                )
            );
        };
        // END TASK REPLY FEATURE

        const MapComponent = ({ lat, lng, pathCoordinates = [], currentAddress, active }) => {
            const mapRef = useRef(null);
            const mapInstance = useRef(null);
            const marker = useRef(null);
            const polyline = useRef(null);
            const resizeTimeout = useRef(null);

            useEffect(() => {
                if (!mapRef.current || mapInstance.current) return;
                
                mapInstance.current = L.map(mapRef.current, { 
                    zoomControl: false, 
                    attributionControl: false
                }).setView([lat || 20.5937, lng || 78.9629], 13);
                
                const darkLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
                    className: 'map-tiles-inverted',
                    maxZoom: 19
                });
                
                const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
                const satelliteLabels = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', { pane: 'markerPane' });
                const satelliteGroup = L.layerGroup([satelliteLayer, satelliteLabels]);

                L.control.layers({ "Dark Mode": darkLayer, "Satellite": satelliteGroup }, null, { position: 'topright' }).addTo(mapInstance.current);
                darkLayer.addTo(mapInstance.current);
                L.control.zoom({ position: 'bottomright' }).addTo(mapInstance.current);

                const handleResize = () => { 
                    if (mapInstance.current) mapInstance.current.invalidateSize(); 
                };
                
                window.addEventListener('resize', handleResize);
                setTimeout(() => mapInstance.current?.invalidateSize(), 100);

                return () => { 
                    window.removeEventListener('resize', handleResize);
                    if (mapInstance.current) { mapInstance.current.remove(); mapInstance.current = null; } 
                };
            }, []);

            useEffect(() => {
                if (!mapInstance.current) return;
                
                clearTimeout(resizeTimeout.current);
                resizeTimeout.current = setTimeout(() => {
                    mapInstance.current?.invalidateSize();
                }, 200);

                if (lat && lng) {
                    mapInstance.current.flyTo([lat, lng], 16);
                    const popupHtml = `<div class="text-xs p-1 font-sans"><strong class="text-accent">Live Position</strong><br/>${currentAddress || 'Locating...'}<br/><span class="text-gray-500 font-mono">${lat.toFixed(5)}, ${lng.toFixed(5)}</span></div>`;
                    
                    if (marker.current) { 
                        marker.current.setLatLng([lat, lng]).setPopupContent(popupHtml); 
                    } else { 
                        marker.current = L.marker([lat, lng]).addTo(mapInstance.current).bindPopup(popupHtml); 
                    }
                }
                
                if (pathCoordinates.length > 0) {
                    const latLngs = pathCoordinates.map(p => [p.lat, p.lng]);
                    if (polyline.current) { 
                        polyline.current.setLatLngs(latLngs); 
                    } else { 
                        polyline.current = L.polyline(latLngs, { color: '#00d1ff', weight: 4 }).addTo(mapInstance.current); 
                    }
                    mapInstance.current.fitBounds(latLngs, { padding: [50, 50] });
                }
            }, [lat, lng, pathCoordinates, currentAddress, active]);

            return React.createElement("div", { ref: mapRef, className: "w-full h-[40vh] lg:h-[500px] rounded-2xl overflow-hidden shadow-inner border border-tertiary relative z-0 bg-secondary" });
        };

        const Login = ({ onLogin }) => {
            const [form, setForm] = useState({ role: '', id: '', password: '', mobile: '' });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                if (e) e.preventDefault();
                if (!form.role) { setError('Please select a role'); return; }
                setError('');
                setLoading(true);
                try {
                    const localUsersJson = localStorage.getItem('track_field_users');
                    if (localUsersJson) {
                        const localUsers = JSON.parse(localUsersJson);
                        const inputId = form.id.trim();
                        const localUser = localUsers.find(u => u.user_id.toLowerCase() === inputId.toLowerCase());
                        if (localUser) {
                            if (localUser.password !== form.password) throw new Error('Incorrect Password');
                            if (localUser.mobile_no !== form.mobile) throw new Error('Incorrect Mobile Number');
                            if (localUser.role !== form.role) throw new Error('Unauthorized Role');
                            onLogin(localUser);
                            setLoading(false);
                            return;
                        }
                    }
                    const { data, error: sbError } = await supabase.from('user_profiles').select('*').eq('user_id', form.id.trim()).single();
                    if (sbError || !data) throw new Error('Invalid User ID or user not found');
                    if (data.password !== form.password) throw new Error('Incorrect Password');
                    if (data.mobile_no !== form.mobile) throw new Error('Incorrect Mobile Number');
                    if (data.role !== form.role) throw new Error('Unauthorized Role');
                    
                    await supabase.from('user_profiles').update({ is_online: true, last_sync: new Date().toISOString() }).eq('user_id', data.user_id);
                    
                    onLogin(data);
                } catch (err) { setError(err.message || 'Login failed'); } finally { setLoading(false); }
            };

            return React.createElement("div", { className: "flex flex-col lg:flex-row min-h-screen w-full font-sans bg-brandMain" },
                React.createElement("div", { className: "hidden lg:flex w-[350px] xl:w-[400px] bg-brandNav flex-col items-center justify-center p-8 border-r border-[#1a3a5a] relative z-10 shrink-0" },
                    React.createElement("div", { className: "flex flex-col items-center mb-auto mt-12" },
                        React.createElement("div", { className: "w-32 h-32 rounded-full border-2 border-accent p-1.5 mb-8 flex items-center justify-center shadow-[0_0_30px_rgba(0,209,255,0.1)]" },
                            React.createElement("div", { className: "w-full h-full rounded-full bg-brandMain flex flex-col items-center justify-center text-center p-4" },
                                React.createElement(Icons.Rocket, null)
                            )
                        ),
                        React.createElement("h1", { className: "text-4xl font-black text-white tracking-tight mb-2" }, "TRACKER"),
                        React.createElement("p", { className: "text-gray-500 font-medium tracking-widest text-xs uppercase" }, "Field Force Management")
                    ),
                    React.createElement("div", { className: "mt-auto mb-12 text-center opacity-50 text-sm text-gray-400" }, "v2.0.4 Stable Build")
                ),
                React.createElement("div", { className: "flex-1 bg-brandMain flex flex-col justify-center items-center p-4 lg:p-12 relative" },
                    React.createElement("div", { className: "w-full max-w-md" },
                        React.createElement("div", { className: "mb-8 lg:hidden flex flex-col items-center" },
                           React.createElement("div", { className: "w-16 h-16 rounded-full border border-accent p-1 mb-4 flex items-center justify-center bg-brandNav" }, React.createElement(Icons.Rocket, null)),
                           React.createElement("h1", { className: "text-2xl font-bold text-white" }, "Login")
                        ),
                        React.createElement("h2", { className: "hidden lg:block text-3xl font-bold text-white mb-10 tracking-tight" }, "Welcome Back"),
                        error && React.createElement("div", { className: "mb-6 p-3 bg-danger/10 border border-danger/20 text-danger rounded-xl text-sm font-semibold flex items-center gap-3 animate-fade-in" }, error),
                        React.createElement("form", { onSubmit: handleSubmit, className: "space-y-5" },
                            React.createElement("div", null,
                                React.createElement("label", { className: "block text-xs font-bold text-gray-400 uppercase mb-2 ml-1" }, "Employee ID"),
                                React.createElement("input", { required: true, value: form.id, onChange: e => setForm({ ...form, id: e.target.value }), className: "modern-input", placeholder: "SCS-XXXXX" })
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { className: "block text-xs font-bold text-gray-400 uppercase mb-2 ml-1" }, "Mobile Number"),
                                React.createElement("input", { required: true, value: form.mobile, onChange: e => setForm({ ...form, mobile: e.target.value }), className: "modern-input", placeholder: "98765 43210" })
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { className: "block text-xs font-bold text-gray-400 uppercase mb-2 ml-1" }, "Role"),
                                React.createElement("select", { required: true, value: form.role, onChange: e => setForm({ ...form, role: e.target.value }), className: "modern-input" },
                                    React.createElement("option", { value: "", disabled: true }, "Select Role"),
                                    React.createElement("option", { value: "employee" }, "Employee"),
                                    React.createElement("option", { value: "admin" }, "Admin")
                                )
                            ),
                            React.createElement("div", null,
                                React.createElement("label", { className: "block text-xs font-bold text-gray-400 uppercase mb-2 ml-1" }, "Password"),
                                React.createElement("input", { required: true, type: "password", value: form.password, onChange: e => setForm({ ...form, password: e.target.value }), className: "modern-input", placeholder: "••••••••" })
                            ),
                            React.createElement("button", { disabled: loading, type: "submit", className: "w-full bg-accent hover:bg-accentHover text-brandNav font-black py-4 rounded-xl transition-all shadow-lg shadow-accent/10 disabled:opacity-50 text-lg uppercase tracking-wider mt-4 min-h-[56px]" }, loading ? 'Authenticating...' : 'Login')
                        )
                    )
                )
            );
        };

        const Dashboard = ({ user }) => React.createElement("div", { className: "space-y-6 animate-fade-in pb-20 lg:pb-0" },
            React.createElement("div", { className: "relative bg-gradient-to-r from-secondary to-primary p-6 rounded-2xl border border-tertiary shadow-lg overflow-hidden" },
                React.createElement("div", { className: "relative z-10" },
                    React.createElement("h2", { className: "text-2xl font-bold text-white mb-2" }, "Hi, ", React.createElement("span", { className: "text-accent" }, user.name.split(' ')[0])),
                    React.createElement("p", { className: "text-gray-400 text-sm" }, "Here's what's happening today.")
                ),
                React.createElement("div", { className: "absolute right-[-20px] top-[-20px] text-accent opacity-5 transform rotate-12" }, React.createElement(Icons.Rocket, null))
            ),
            React.createElement("div", { className: "grid grid-cols-2 lg:grid-cols-4 gap-4" },
                React.createElement(StatCard, { icon: React.createElement(Icons.Activity, null), label: "Daily Activity", value: "Tracked", color: "accent" }),
                React.createElement(StatCard, { icon: React.createElement(Icons.ClipboardList, null), label: "Tasks", value: "Pending", color: "warning" }),
                React.createElement(StatCard, { icon: React.createElement(Icons.Chat, null), label: "Chats", value: "New", color: "success" }),
                React.createElement(StatCard, { icon: React.createElement(Icons.FollowUp, null), label: "Follow Ups", value: "Active", color: "danger" })
            )
        );

        const StatCard = ({ icon, label, value, color }) => React.createElement("div", { className: "bg-secondary p-4 rounded-xl border border-tertiary shadow-sm group hover:border-accent/30 transition-colors" },
            React.createElement("div", { className: `text-${color} mb-3 bg-${color}/10 w-fit p-2.5 rounded-lg group-hover:scale-110 transition-transform` }, icon),
            React.createElement("p", { className: "text-[10px] font-bold text-gray-500 uppercase tracking-wider" }, label),
            React.createElement("p", { className: "text-lg font-bold text-white" }, value)
        );

        const DailyActivity = ({ user, allEmployees }) => {
            const [logs, setLogs] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterDate, setFilterDate] = useState(new Date().toISOString().split('T')[0]);
            const [filterEmp, setFilterEmp] = useState('');
            const [search, setSearch] = useState('');
            const [checkInSession, setCheckInSession] = useState(localStorage.getItem(`checkin_${user.user_id}`));
            const [currentLoc, setCurrentLoc] = useState(null);
            const [displayAddress, setDisplayAddress] = useState('Locating...');
            const [showVisitModal, setShowVisitModal] = useState(false);
            const [visitData, setVisitData] = useState({ client: '', purpose: '' });
            const watchId = useRef(null);

            const fetchLogs = useCallback(async () => {
                setLoading(true);
                let query = supabase.from('daily_activity').select('*').order('created_at', { ascending: false });
                if (user.role === 'employee') query = query.eq('user_id', user.user_id);
                else if (filterEmp) query = query.eq('user_id', filterEmp);
                
                const { data, error } = await query;
                if (!error && data) {
                    let filtered = data.filter(l => l.created_at.startsWith(filterDate));
                    if (search) {
                        const s = search.toLowerCase();
                        filtered = filtered.filter(l => l.user_id.toLowerCase().includes(s) || (l.location && l.location.toLowerCase().includes(s)));
                    }
                    setLogs(filtered);
                }
                setLoading(false);
            }, [user, filterDate, filterEmp, search]);

            useEffect(() => { fetchLogs(); }, [fetchLogs]);
            
            useEffect(() => {
                if (navigator.geolocation) {
                    watchId.current = navigator.geolocation.watchPosition(async (pos) => {
                        const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                        setCurrentLoc(loc);
                        const addr = await reverseGeocode(loc.lat, loc.lng);
                        setDisplayAddress(addr);
                    }, (err) => {
                        console.error("GPS Error:", err);
                        setDisplayAddress("GPS Signal Lost");
                    }, { enableHighAccuracy: true, timeout: 10000 });
                }
                return () => { if (watchId.current) navigator.geolocation.clearWatch(watchId.current); };
            }, []);

            const handleAction = async (type) => {
                if (!currentLoc) return alert("Waiting for accurate GPS...");
                
                let finalLocation = displayAddress;
                if (finalLocation === 'Locating...') {
                    finalLocation = await reverseGeocode(currentLoc.lat, currentLoc.lng);
                    setDisplayAddress(finalLocation);
                }

                if (type === 'checkin') {
                   await supabase.from('user_profiles').update({ is_tracking_active: true }).eq('user_id', user.user_id);
                } else if (type === 'checkout') {
                   await supabase.from('user_profiles').update({ is_tracking_active: false }).eq('user_id', user.user_id);
                }

                const { data, error } = await supabase.from('daily_activity').insert([{ 
                    user_id: user.user_id, 
                    type, 
                    latitude: currentLoc.lat, 
                    longitude: currentLoc.lng, 
                    location: finalLocation,
                    created_at: new Date().toISOString() 
                }]).select();
                
                if (error) alert(error.message);
                else {
                    if (type === 'checkin') {
                        localStorage.setItem(`checkin_${user.user_id}`, data[0].id);
                        setCheckInSession(data[0].id);
                        setShowVisitModal(true);
                    } else if (type === 'checkout') {
                        localStorage.removeItem(`checkin_${user.user_id}`);
                        setCheckInSession(null);
                    }
                    fetchLogs();
                }
            };

            const submitVisit = async () => {
                if (!visitData.client) return alert("Client name required");
                
                let finalLocation = displayAddress;
                if (finalLocation === 'Locating...') {
                    finalLocation = await reverseGeocode(currentLoc.lat, currentLoc.lng);
                    setDisplayAddress(finalLocation);
                }

                const { error } = await supabase.from('daily_activity').insert([{
                    user_id: user.user_id,
                    type: 'visit',
                    latitude: currentLoc.lat,
                    longitude: currentLoc.lng,
                    location: finalLocation,
                    description: `Client: ${visitData.client}`,
                    details: visitData.purpose,
                    created_at: new Date().toISOString()
                }]);
                if (error) alert(error.message);
                else { setShowVisitModal(false); setVisitData({ client: '', purpose: '' }); fetchLogs(); }
            };

            const pathCoords = logs.filter(l => l.latitude && l.longitude).map(l => ({ lat: l.latitude, lng: l.longitude })).reverse();
            const changeDate = (days) => {
                const d = new Date(filterDate);
                d.setDate(d.getDate() + days);
                setFilterDate(d.toISOString().split('T')[0]);
            };

            return React.createElement("div", { className: "space-y-6 animate-fade-in pb-24" },
                React.createElement("div", { className: "flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4" },
                    React.createElement("h2", { className: "text-2xl font-bold text-white tracking-tight" }, "Activity Log"),
                    React.createElement("div", { className: "flex gap-3 w-full sm:w-auto" },
                        !checkInSession ? 
                            React.createElement("button", { onClick: () => handleAction('checkin'), className: "flex-1 sm:flex-none bg-success text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-success/20 active:scale-95 transition-all flex justify-center items-center gap-2 min-h-[48px]" }, "Check In") :
                            React.createElement("button", { onClick: () => handleAction('checkout'), className: "flex-1 sm:flex-none bg-danger text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-danger/20 active:scale-95 transition-all flex justify-center items-center gap-2 min-h-[48px]" }, "Check Out")
                    )
                ),
                React.createElement("div", { className: "bg-secondary border border-tertiary p-4 rounded-2xl shadow-lg flex flex-wrap gap-4 items-end" },
                    React.createElement("div", { className: "flex-1 min-w-[140px]" },
                        React.createElement("label", { className: "block text-xs font-bold text-gray-400 mb-1 uppercase" }, "Date"),
                        React.createElement("div", { className: "flex items-center bg-primary rounded-lg p-1 border border-tertiary" },
                            React.createElement("button", { onClick: () => changeDate(-1), className: "p-2 hover:bg-tertiary rounded-md text-gray-400" }, React.createElement(Icons.ChevronLeft, null)),
                            React.createElement("input", { type: "date", value: filterDate, onChange: e=>setFilterDate(e.target.value), className: "bg-transparent text-white text-sm border-none focus:ring-0 outline-none w-full text-center cursor-pointer" }),
                            React.createElement("button", { onClick: () => changeDate(1), className: "p-2 hover:bg-tertiary rounded-md text-gray-400" }, React.createElement(Icons.ChevronLeft, { className: "rotate-180" }))
                        )
                    ),
                    user.role === 'admin' && React.createElement("div", { className: "flex-1 min-w-[140px]" },
                        React.createElement("label", { className: "block text-xs font-bold text-gray-400 mb-1 uppercase" }, "User"),
                        React.createElement("select", { value: filterEmp, onChange: e=>setFilterEmp(e.target.value), className: "modern-input text-sm" },
                            React.createElement("option", { value: "" }, "All Users"),
                            allEmployees.map(e => React.createElement("option", { key: e.user_id, value: e.user_id }, e.name))
                        )
                    ),
                    React.createElement("div", { className: "flex-1 min-w-[140px]" },
                        React.createElement("label", { className: "block text-xs font-bold text-gray-400 mb-1 uppercase" }, "Search Logs"),
                        React.createElement("input", { type: "text", placeholder: "Location...", value: search, onChange: e=>setSearch(e.target.value), className: "modern-input text-sm" })
                    ),
                    React.createElement("button", { onClick: () => exportToCSV(logs, 'ActivityLog'), className: "bg-tertiary hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl text-sm transition-all" }, "Export")
                ),
                
                React.createElement("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                    React.createElement("div", { className: "lg:col-span-2" }, React.createElement(MapComponent, { lat: currentLoc?.lat || 0, lng: currentLoc?.lng || 0, pathCoordinates: pathCoords, currentAddress: displayAddress, active: true })),
                    React.createElement("div", { className: "bg-secondary p-5 rounded-2xl border border-tertiary space-y-4 shadow-xl flex flex-col justify-center" },
                        React.createElement("div", null, React.createElement("p", { className: "text-xs text-gray-500 uppercase font-bold" }, "Current Address"), React.createElement("p", { className: "text-sm text-gray-300 leading-snug mt-1" }, displayAddress)),
                        React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                            React.createElement("div", { className: "bg-primary/30 p-3 rounded-lg" }, React.createElement("p", { className: "text-[10px] text-gray-500 uppercase font-black" }, "Lat"), React.createElement("p", { className: "font-mono text-accent text-sm truncate" }, currentLoc?.lat.toFixed(5) || '--')),
                            React.createElement("div", { className: "bg-primary/30 p-3 rounded-lg" }, React.createElement("p", { className: "text-[10px] text-gray-500 uppercase font-black" }, "Lng"), React.createElement("p", { className: "font-mono text-accent text-sm truncate" }, currentLoc?.lng.toFixed(5) || '--'))
                        ),
                         React.createElement("div", { className: "pt-2" }, 
                            React.createElement("p", { className: "text-[10px] text-gray-500 uppercase font-bold mb-1" }, "Status"),
                            React.createElement("span", { className: `px-3 py-1 rounded-full text-[10px] font-black uppercase ${checkInSession ? "bg-success/20 text-success" : "bg-white/5 text-gray-500"}` }, checkInSession ? "Active Session" : "Standby")
                        )
                    )
                ),

                React.createElement("div", { className: "bg-secondary border border-tertiary rounded-2xl shadow-xl overflow-hidden flex flex-col" },
                    React.createElement("div", { className: "overflow-x-auto custom-scrollbar" },
                        React.createElement("table", { className: "w-full text-left modern-table" },
                            React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", null, "User"), React.createElement("th", null, "Type"), React.createElement("th", null, "Time"), React.createElement("th", null, "Location"), React.createElement("th", null, "Coordinates"), React.createElement("th", null, "Notes"))),
                            React.createElement("tbody", null,
                                loading ? React.createElement("tr", null, React.createElement("td", { colSpan: 6, className: "text-center p-8 text-gray-500" }, "Loading...")) :
                                logs.length === 0 ? React.createElement("tr", null, React.createElement("td", { colSpan: 6, className: "text-center p-8 text-gray-500" }, "No logs found.")) :
                                logs.map(l => React.createElement("tr", { key: l.id },
                                    React.createElement("td", { className: "font-bold text-white text-xs sm:text-sm" }, l.user_id),
                                    React.createElement("td", null, React.createElement("span", { className: `px-2 py-0.5 rounded-full text-[10px] font-black uppercase ${l.type === 'checkin' ? 'bg-success/20 text-success' : l.type === 'checkout' ? 'bg-danger/20 text-danger' : l.type === 'visit' ? 'bg-warning/20 text-warning' : 'bg-accent/20 text-accent'}` }, l.type)),
                                    React.createElement("td", { className: "text-xs font-mono whitespace-nowrap" }, new Date(l.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })),
                                    React.createElement("td", { className: "text-xs sm:text-sm max-w-[150px] sm:max-w-[250px] truncate" }, l.location || 'Unknown'),
                                    React.createElement("td", { className: "text-[10px] sm:text-xs font-mono text-gray-500" }, `${l.latitude?.toFixed(4)}, ${l.longitude?.toFixed(4)}`),
                                    React.createElement("td", { className: "text-[10px] sm:text-xs text-gray-400 italic truncate max-w-[100px]" }, l.description || l.details || '-')
                                ))
                            )
                        )
                    )
                ),
                showVisitModal && React.createElement(Modal, { isOpen: showVisitModal, onClose: () => setShowVisitModal(false), title: "Log Visit" },
                    React.createElement("div", { className: "space-y-4" },
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-sm font-bold text-gray-300" }, "Client Name"), React.createElement("input", { type: "text", className: "modern-input", placeholder: "Company Name", value: visitData.client, onChange: e=>setVisitData({...visitData, client: e.target.value}), autoFocus: true })),
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-sm font-bold text-gray-300" }, "Purpose"), React.createElement("textarea", { className: "modern-input resize-none", rows: 3, placeholder: "Reason...", value: visitData.purpose, onChange: e=>setVisitData({...visitData, purpose: e.target.value}) })),
                        React.createElement("div", { className: "flex gap-3 pt-4" },
                            React.createElement("button", { onClick: submitVisit, className: "flex-1 bg-accent text-primary font-black py-3 rounded-xl hover:bg-accentHover transition-colors shadow-lg" }, "Save"),
                            React.createElement("button", { onClick: () => setShowVisitModal(false), className: "flex-1 bg-tertiary text-white font-bold py-3 rounded-xl" }, "Skip")
                        )
                    )
                )
            );
        };

        const FollowUps = ({ user }) => {
            const [list, setList] = useState([]);
            const [loading, setLoading] = useState(true);
            const [newF, setNewF] = useState({ subject: '', datetime: '', note: '' });

            const fetchF = useCallback(async () => {
                setLoading(true);
                let query = supabase.from('followups').select('*').order('followup_date', { ascending: true });
                if (user.role === 'employee') query = query.eq('user_id', user.user_id);
                const { data, error } = await query;
                if (!error && data) setList(data);
                setLoading(false);
            }, [user]);

            useEffect(() => { fetchF(); }, [fetchF]);

            const handleAdd = async (e) => {
                e.preventDefault();
                const payload = { user_id: user.user_id, subject: newF.subject, followup_date: newF.datetime, notes: newF.note };
                const { error } = await supabase.from('followups').insert([payload]);
                if (!error) { setNewF({ subject: '', datetime: '', note: '' }); fetchF(); } 
                else alert(error.message);
            };

            const handleDelete = async (id) => {
                if (!confirm('Delete this reminder?')) return;
                const { error } = await supabase.from('followups').delete().eq('id', id);
                if (!error) fetchF();
            };

            return React.createElement("div", { className: "space-y-6 animate-fade-in pb-24" },
                React.createElement("h2", { className: "text-2xl font-bold text-white tracking-tight" }, "Follow Ups"),
                React.createElement("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                    React.createElement("div", { className: "bg-secondary border border-tertiary p-6 rounded-3xl shadow-xl h-fit" },
                        React.createElement("h3", { className: "text-lg font-bold text-white mb-6 flex items-center gap-2" }, React.createElement("span", { className: "bg-accent/20 p-2 rounded-lg text-accent" }, React.createElement(Icons.FollowUp, null)), "Set Reminder"),
                        React.createElement("form", { onSubmit: handleAdd, className: "space-y-4" },
                            React.createElement("input", { type: "text", placeholder: "Subject", className: "modern-input", value: newF.subject, onChange: e=>setNewF({...newF, subject: e.target.value}), required: true }),
                            React.createElement("input", { type: "datetime-local", className: "modern-input", value: newF.datetime, onChange: e=>setNewF({...newF, datetime: e.target.value}), required: true }),
                            React.createElement("textarea", { placeholder: "Notes...", className: "modern-input resize-none", rows: 3, value: newF.note, onChange: e=>setNewF({...newF, note: e.target.value}) }),
                            React.createElement("button", { type: "submit", className: "w-full bg-accent hover:bg-accentHover text-primary font-black py-4 rounded-xl transition-all shadow-lg" }, "Create Reminder")
                        )
                    ),
                    React.createElement("div", { className: "lg:col-span-2 bg-secondary border border-tertiary rounded-3xl shadow-xl overflow-hidden flex flex-col min-h-[500px]" },
                        React.createElement("div", { className: "p-5 border-b border-tertiary flex justify-between items-center bg-primary/30" },
                            React.createElement("h3", { className: "font-bold text-white" }, "Upcoming"),
                            React.createElement("button", { onClick: () => exportToCSV(list, 'Reminders'), className: "text-xs bg-tertiary hover:bg-gray-600 px-3 py-1.5 rounded-lg" }, "Export")
                        ),
                        React.createElement("div", { className: "flex-1 overflow-y-auto p-4 custom-scrollbar" },
                            loading ? React.createElement("div", { className: "p-10 text-center text-gray-500" }, "Syncing...") :
                            list.length === 0 ? React.createElement("div", { className: "p-10 text-center text-gray-500" }, "No reminders.") :
                            React.createElement("div", { className: "space-y-3" },
                                list.map(item => React.createElement("div", { key: item.id, className: "group flex items-center justify-between p-4 bg-primary/40 hover:bg-primary/70 border border-tertiary rounded-2xl transition-all" },
                                    React.createElement("div", null,
                                        React.createElement("div", { className: "font-bold text-white" }, item.subject),
                                        React.createElement("div", { className: "text-xs text-accent font-mono mt-1" }, new Date(item.followup_date).toLocaleString()),
                                        React.createElement("div", { className: "text-xs text-gray-400 mt-2 line-clamp-2" }, item.notes)
                                    ),
                                    React.createElement("button", { onClick: () => handleDelete(item.id), className: "p-2 text-danger hover:bg-danger/10 rounded-lg transition-all" }, React.createElement(Icons.Delete, null))
                                ))
                            )
                        )
                    )
                )
            );
        };

        const AdminManagement = ({ type }) => {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isModalOpen, setModalOpen] = useState(false);
            const [isEditMode, setIsEditMode] = useState(false);
            const [form, setForm] = useState({ id: '', name: '', mobile: '', email: '', password: '' });

            const fetchUsers = useCallback(async () => {
                setLoading(true);
                const role = type === 'admin' ? 'admin' : 'employee';
                const { data, error } = await supabase.from('user_profiles').select('*').eq('role', role).order('name');
                if (!error && data) setUsers(data);
                setLoading(false);
            }, [type]);

            useEffect(() => { fetchUsers(); }, [fetchUsers]);

            const handleDelete = async (id) => {
                if (!confirm(`Delete ${id}?`)) return;
                const { error } = await supabase.from('user_profiles').delete().eq('user_id', id);
                if (!error) fetchUsers();
            };

            const openAddModal = () => {
                setIsEditMode(false);
                setForm({ id: '', name: '', mobile: '', email: '', password: 'scube@1234' });
                setModalOpen(true);
            };

            const openEditModal = (u) => {
                setIsEditMode(true);
                setForm({ id: u.user_id, name: u.name, mobile: u.mobile_no, email: u.email || '', password: u.password });
                setModalOpen(true);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const payload = { 
                    user_id: form.id.toUpperCase(), 
                    name: form.name, 
                    mobile_no: form.mobile, 
                    email: form.email, 
                    password: form.password, 
                    role: type === 'admin' ? 'admin' : 'employee' 
                };
                const { error } = await supabase.from('user_profiles').upsert([payload]);
                if (error) alert(error.message);
                else { setModalOpen(false); fetchUsers(); }
            };

            return React.createElement("div", { className: "bg-secondary border border-tertiary rounded-3xl shadow-xl overflow-hidden animate-fade-in pb-24" },
                React.createElement("div", { className: "p-6 border-b border-tertiary flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-primary/30" },
                    React.createElement("div", null, 
                        React.createElement("h2", { className: "text-2xl font-bold text-white" }, type === 'admin' ? 'Admins' : 'Employees'),
                        React.createElement("p", { className: "text-xs text-gray-500 mt-1" }, `Manage ${type} accounts`)
                    ),
                    React.createElement("div", { className: "flex gap-2 w-full sm:w-auto" },
                        React.createElement("button", { onClick: openAddModal, className: "flex-1 sm:flex-none bg-accent hover:bg-accentHover text-primary font-black py-2.5 px-6 rounded-xl text-sm transition-all shadow-lg flex items-center justify-center gap-2" }, React.createElement(Icons.Rocket, null), "Add New"),
                        React.createElement("button", { onClick: () => exportToCSV(users, `${type}_list`), className: "flex-1 sm:flex-none bg-tertiary hover:bg-gray-600 text-white font-bold py-2.5 px-6 rounded-xl text-sm transition-all" }, "Export")
                    )
                ),
                React.createElement("div", { className: "modern-table-wrapper" },
                    React.createElement("table", { className: "w-full text-left modern-table" },
                        React.createElement("thead", null, React.createElement("tr", null, React.createElement("th", null, "ID"), React.createElement("th", null, "Name"), React.createElement("th", null, "Contact"), React.createElement("th", null, "Email"), React.createElement("th", null, "Actions"))),
                        React.createElement("tbody", null,
                            loading ? React.createElement("tr", null, React.createElement("td", { colSpan: 5, className: "p-10 text-center text-gray-500" }, "Loading...")) :
                            users.length === 0 ? React.createElement("tr", null, React.createElement("td", { colSpan: 5, className: "p-10 text-center text-gray-500" }, "No records.")) :
                            users.map(u => React.createElement("tr", { key: u.user_id },
                                React.createElement("td", { className: "font-mono text-accent text-xs sm:text-sm" }, u.user_id),
                                React.createElement("td", { className: "font-bold text-white text-sm" }, u.name),
                                React.createElement("td", { className: "text-sm" }, u.mobile_no),
                                React.createElement("td", { className: "text-gray-400 text-sm italic" }, u.email || 'N/A'),
                                React.createElement("td", null, React.createElement("div", { className: "flex gap-2" },
                                    React.createElement("button", { onClick: () => openEditModal(u), className: "p-2 bg-warning/10 text-warning hover:bg-warning/20 rounded-lg transition-colors" }, React.createElement(Icons.Edit, null)),
                                    React.createElement("button", { onClick: () => handleDelete(u.user_id), className: "p-2 bg-danger/10 text-danger hover:bg-danger/20 rounded-lg transition-colors" }, React.createElement(Icons.Delete, null))
                                ))
                            ))
                        )
                    )
                ),
                isModalOpen && React.createElement(Modal, { isOpen: isModalOpen, onClose: () => setModalOpen(false), title: isEditMode ? `Edit ${type}` : `Add ${type}` },
                    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-xs font-bold text-gray-400 uppercase" }, "User ID"), React.createElement("input", { type: "text", className: "modern-input", value: form.id, onChange: e=>setForm({...form, id: e.target.value}), disabled: isEditMode, required: true, placeholder: "ID" })),
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-xs font-bold text-gray-400 uppercase" }, "Name"), React.createElement("input", { type: "text", className: "modern-input", value: form.name, onChange: e=>setForm({...form, name: e.target.value}), required: true })),
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-xs font-bold text-gray-400 uppercase" }, "Mobile"), React.createElement("input", { type: "tel", className: "modern-input", value: form.mobile, onChange: e=>setForm({...form, mobile: e.target.value}), required: true })),
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-xs font-bold text-gray-400 uppercase" }, "Email"), React.createElement("input", { type: "email", className: "modern-input", value: form.email, onChange: e=>setForm({...form, email: e.target.value}) })),
                        React.createElement("div", null, React.createElement("label", { className: "block mb-1 text-xs font-bold text-gray-400 uppercase" }, "Password"), React.createElement("input", { type: "password", className: "modern-input", value: form.password, onChange: e=>setForm({...form, password: e.target.value}), required: true })),
                        React.createElement("button", { type: "submit", className: "w-full bg-accent text-primary font-black py-4 rounded-xl mt-4 transition-all" }, isEditMode ? 'Update' : 'Create')
                    )
                )
            );
        };

        const ChatSystem = ({ user, allUsers }) => {
            const [activeContact, setActiveContact] = useState(null);
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [contactList, setContactList] = useState([]);
            const [view, setView] = useState('list');
            const [showScrollDownBtn, setShowScrollDownBtn] = useState(false);
            const [selectedFile, setSelectedFile] = useState(null);
            const [uploading, setUploading] = useState(false);
            const [errorConfig, setErrorConfig] = useState(null);

            const scrollRef = useRef(null);
            const chatContainerRef = useRef(null);
            const shouldAutoScroll = useRef(true);
            const fileInputRef = useRef(null);

            const isMobile = window.innerWidth < 1024;

            const fetchSidebarData = useCallback(async () => {
                const { data, error } = await supabase.from('chat_messages').select('*').or(`sender_id.eq.${user.user_id},receiver_id.eq.${user.user_id}`).order('created_at', { ascending: false });
                if (!error && data) {
                    const updated = allUsers.filter(u => u.user_id !== user.user_id).map(u => {
                        const userMsgs = data.filter(m => m.sender_id === u.user_id || m.receiver_id === u.user_id);
                        const lastMsg = userMsgs[0];
                        const lastSeenKey = `last_chat_view_${user.user_id}_${u.user_id}`;
                        const lastSeen = localStorage.getItem(lastSeenKey) || new Date(0).toISOString();
                        const unread = userMsgs.filter(m => m.receiver_id === user.user_id && m.created_at > lastSeen).length;
                        return { ...u, lastMessage: lastMsg?.message || (lastMsg?.file_url ? 'Attachment' : ''), lastTimestamp: lastMsg?.created_at || '', unreadCount: unread };
                    }).sort((a, b) => (b.lastTimestamp || '').localeCompare(a.lastTimestamp || ''));
                    setContactList(updated);
                }
            }, [user.user_id, allUsers]);

            const fetchMessages = useCallback(async () => {
                if (!activeContact) return;
                const { data, error } = await supabase.from('chat_messages').select('*').or(`and(sender_id.eq.${user.user_id},receiver_id.eq.${activeContact.user_id}),and(sender_id.eq.${activeContact.user_id},receiver_id.eq.${user.user_id})`).order('created_at', { ascending: true });
                if (!error && data) {
                    setMessages(data);
                    const lastSeenKey = `last_chat_view_${user.user_id}_${activeContact.user_id}`;
                    localStorage.setItem(lastSeenKey, new Date().toISOString());
                }
            }, [user.user_id, activeContact]);

            useEffect(() => { fetchSidebarData(); const itv = setInterval(fetchSidebarData, 10000); return () => clearInterval(itv); }, [fetchSidebarData]);
            useEffect(() => { if (activeContact) { fetchMessages(); const itv = setInterval(fetchMessages, 5000); return () => clearInterval(itv); } }, [activeContact, fetchMessages]);
            
            useEffect(() => { 
                if (shouldAutoScroll.current && scrollRef.current) {
                    scrollRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' }); 
                }
            }, [messages]);

            const handleScroll = () => {
                if (!chatContainerRef.current) return;
                const { scrollTop, scrollHeight, clientHeight } = chatContainerRef.current;
                const distanceFromBottom = scrollHeight - scrollTop - clientHeight;
                const isNearBottom = distanceFromBottom < 120;
                shouldAutoScroll.current = isNearBottom;
                setShowScrollDownBtn(!isNearBottom);
            };

            const scrollToBottom = () => {
                shouldAutoScroll.current = true;
                scrollRef.current?.scrollIntoView({ behavior: 'smooth' });
                setShowScrollDownBtn(false);
            };

            const selectContact = (u) => { 
                setActiveContact(u); 
                shouldAutoScroll.current = true; 
                if (isMobile) setView('chat'); 
            };
            
            const backToList = () => { setActiveContact(null); setView('list'); fetchSidebarData(); };

            const handleSend = async (e) => {
                e.preventDefault(); 
                if ((!inputText.trim() && !selectedFile) || !activeContact) return;
                
                setUploading(true);
                setErrorConfig(null);
                let filePayload = {};
                
                try {
                    if (selectedFile) {
                        const fileExt = selectedFile.name.split('.').pop();
                        const fileName = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}.${fileExt}`;
                        const filePath = `${user.user_id}/${fileName}`;
                        
                        const { data, error: uploadError } = await supabase.storage
                            .from('chat-uploads')
                            .upload(filePath, selectedFile, {
                                cacheControl: '3600',
                                upsert: false
                            });
                        
                        if (uploadError) {
                            throw new Error(`Storage Error: ${uploadError.message}`);
                        }

                        const { data: { publicUrl } } = supabase.storage
                            .from('chat-uploads')
                            .getPublicUrl(filePath);
                        
                        let fileType = 'image';
                        if (selectedFile.type.includes('pdf')) fileType = 'pdf';

                        filePayload = {
                            file_url: publicUrl,
                            file_type: fileType,
                            mime_type: selectedFile.type,
                            file_size_kb: Math.round(selectedFile.size / 1024)
                        };
                    }

                    const msgText = inputText.trim();
                    const { error: dbError } = await supabase.from('chat_messages').insert([{
                        sender_id: user.user_id, 
                        receiver_id: activeContact.user_id, 
                        message: msgText,
                        ...filePayload
                    }]);

                    if (dbError) throw new Error(`Database Error: ${dbError.message}`);

                    setInputText('');
                    setSelectedFile(null);
                    if (fileInputRef.current) fileInputRef.current.value = '';
                    fetchMessages(); 
                    fetchSidebarData(); 
                    shouldAutoScroll.current = true;

                } catch (err) {
                    console.error("Full error:", err);
                    const msg = err.message;
                    const isRLS = msg.includes('row-level security') || msg.includes('new row violates');
                    
                    if (isRLS && msg.includes('Storage Error')) {
                        setErrorConfig({
                            title: "Storage Permission Denied",
                            desc: "Your Supabase storage bucket 'chat-uploads' exists but blocks uploads. Run this SQL to fix it:",
                            sql: "create policy \"Allow Public Uploads\" on storage.objects for insert to public with check ( bucket_id = 'chat-uploads' );"
                        });
                    } else if (isRLS && msg.includes('Database Error')) {
                        setErrorConfig({
                            title: "Database Permission Denied",
                            desc: "The 'chat_messages' table is blocking inserts. Since you aren't using Supabase Auth, you need to allow public/anon access:",
                            sql: "create policy \"Allow Public Insert\" on public.chat_messages for insert to public with check (true);"
                        });
                    } else {
                        alert(msg);
                    }
                } finally {
                    setUploading(false);
                }
            };
            
            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                if (file) setSelectedFile(file);
            };

            const clearSelectedFile = () => {
                setSelectedFile(null);
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            return React.createElement("div", { className: "flex flex-col lg:flex-row h-full bg-[#111b21] rounded-2xl overflow-hidden border border-white/5 shadow-2xl relative" },
                React.createElement("div", { className: `${isMobile && view === 'chat' ? 'hidden' : 'flex'} w-full lg:w-[350px] flex-col bg-[#111b21] border-r border-white/10 shrink-0` },
                    React.createElement("div", { className: "p-4 bg-[#202c33] flex items-center justify-between shrink-0" },
                        React.createElement("span", { className: "font-bold text-gray-200" }, "Chats"),
                        React.createElement(Icons.Users, null)
                    ),
                    React.createElement("div", { className: "p-2 shrink-0" }, React.createElement("div", { className: "bg-[#2a3942] px-3 py-2 rounded-lg flex items-center gap-2" }, React.createElement("svg", { className:"w-4 h-4 text-gray-500", fill:"none", stroke:"currentColor", viewBox:"0 0 24 24" }, React.createElement("path",{ strokeLinecap:"round", strokeLinejoin:"round", strokeWidth:"2", d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})), React.createElement("input", { value: searchTerm, onChange: e => setSearchTerm(e.target.value), placeholder: "Search", className: "bg-transparent text-sm text-gray-200 outline-none w-full" }))),
                    React.createElement("div", { className: "flex-1 overflow-y-auto custom-scrollbar" },
                        contactList.filter(u => u.name.toLowerCase().includes(searchTerm.toLowerCase())).map(u => React.createElement("button", { key: u.user_id, onClick: () => selectContact(u), className: `w-full flex items-center gap-3 px-4 py-3 border-b border-white/5 transition-colors ${activeContact?.user_id === u.user_id ? 'bg-[#2a3942]' : 'hover:bg-[#202c33]'}` },
                            React.createElement("div", { className: "relative" }, 
                                React.createElement("img", { src: u.photo_url || `https://picsum.photos/seed/${u.user_id}/40/40`, className: "w-10 h-10 rounded-full" }),
                                u.unreadCount > 0 && React.createElement("span", { className: "absolute -top-1 -right-1 bg-success text-[#111b21] text-[9px] font-black min-w-[16px] h-4 flex items-center justify-center rounded-full border border-[#111b21]" }, u.unreadCount)
                            ),
                            React.createElement("div", { className: "flex-1 text-left overflow-hidden" },
                                React.createElement("div", { className: "flex justify-between items-center" }, React.createElement("p", { className: "font-semibold text-white text-sm truncate" }, u.name), React.createElement("span", { className: "text-[9px] text-gray-500" }, u.lastTimestamp ? new Date(u.lastTimestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '')),
                                React.createElement("div", { className: "text-left" }, React.createElement("p", { className: "text-xs text-gray-400 truncate pr-2" }, u.lastMessage))
                            )
                        ))
                    )
                ),
                React.createElement("div", { className: `${isMobile && view === 'list' ? 'hidden' : 'flex'} flex-1 flex flex-col bg-[#0b141a] relative min-h-0` },
                    !activeContact ? React.createElement("div", { className: "flex-1 flex flex-col items-center justify-center p-6 text-center" },
                        React.createElement("div", { className: "p-6 bg-accent/5 rounded-full mb-6 text-accent opacity-20" }, React.createElement(Icons.Chat, null)),
                        React.createElement("h2", { className: "text-xl font-light text-gray-300" }, "Select a chat"),
                        React.createElement("p", { className: "text-gray-500 text-xs mt-2" }, "to start messaging")
                    ) : React.createElement(React.Fragment, null,
                        React.createElement("div", { className: "p-3 px-4 bg-[#202c33] flex items-center gap-3 border-l border-white/5 z-10 shrink-0 shadow-md" },
                            isMobile && React.createElement("button", { onClick: backToList, className: "text-gray-400 p-1 mr-1" }, React.createElement(Icons.ChevronLeft, null)),
                            React.createElement("img", { src: activeContact.photo_url || `https://picsum.photos/seed/${activeContact.user_id}/40/40`, className: "w-8 h-8 rounded-full" }),
                            React.createElement("div", null, React.createElement("h4", { className: "font-semibold text-white text-sm leading-tight" }, activeContact.name), React.createElement("p", { className: "text-[9px] text-success" }, activeContact.is_online ? "online" : "offline"))
                        ),
                        
                        React.createElement("div", { 
                            ref: chatContainerRef, 
                            onScroll: handleScroll,
                            className: "flex-1 overflow-y-auto p-3 sm:p-4 space-y-2 custom-scrollbar bg-[#0b141a] relative overscroll-y-contain min-h-0",
                            style: { WebkitOverflowScrolling: 'touch' } 
                        },
                            messages.map(m => {
                                const isMe = m.sender_id === user.user_id;
                                return React.createElement("div", { key: m.id, className: `flex w-full ${isMe ? 'justify-end' : 'justify-start'}` },
                                    React.createElement("div", { className: `max-w-[85%] sm:max-w-[70%] p-2.5 rounded-xl text-sm shadow-sm relative ${isMe ? 'bg-[#005c4b] text-white rounded-tr-none bubble-me' : 'bg-[#202c33] text-white rounded-tl-none bubble-them'}` },
                                        m.file_url && m.file_type === 'image' && React.createElement("img", { src: m.file_url, className: "rounded-lg mb-2 max-w-full h-auto border border-white/10" }),
                                        m.file_url && m.file_type === 'pdf' && React.createElement("a", { href: m.file_url, target: "_blank", className: "flex items-center gap-2 bg-black/20 p-2 rounded hover:bg-black/30 transition-colors mb-2 text-accent text-xs font-bold uppercase" }, React.createElement(Icons.PaperClip, null), " View PDF"),
                                        m.message && React.createElement("p", { className: "px-1 pr-8 whitespace-pre-wrap break-words text-sm leading-relaxed" }, m.message),
                                        React.createElement("div", { className: "flex justify-end items-center gap-1 mt-1 text-[8px] opacity-60 absolute bottom-1 right-2" }, React.createElement("span", null, new Date(m.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })), isMe && React.createElement(Icons.DoubleCheck, null))
                                    )
                                );
                            }),
                            React.createElement("div", { ref: scrollRef, className: "h-2" })
                        ),

                        showScrollDownBtn && React.createElement("button", { 
                            onClick: scrollToBottom, 
                            className: "absolute bottom-20 right-6 z-20 bg-[#202c33] text-accent p-3 rounded-full shadow-lg border border-white/10 hover:bg-[#2a3942] transition-all animate-bounce opacity-90 hover:opacity-100"
                        }, React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M19 14l-7 7m0 0l-7-7m7 7V3" }))),
                        
                        errorConfig && React.createElement("div", { className: "absolute bottom-20 left-4 right-4 lg:left-10 lg:right-10 bg-secondary border border-danger p-4 rounded-xl shadow-2xl z-50 flex flex-col gap-2 animate-slide-in" },
                            React.createElement("div", { className: "flex justify-between items-start" },
                                React.createElement("h4", { className: "text-danger font-bold flex items-center gap-2 text-sm" },
                                    React.createElement(Icons.Close, { className: "w-4 h-4" }), " ", errorConfig.title
                                ),
                                React.createElement("button", { onClick: () => setErrorConfig(null), className: "text-gray-400 hover:text-white" }, React.createElement(Icons.Close))
                            ),
                            React.createElement("p", { className: "text-xs text-gray-300" }, errorConfig.desc),
                            React.createElement("div", { className: "bg-black/50 p-2 rounded text-[10px] font-mono text-success overflow-x-auto whitespace-nowrap" },
                                errorConfig.sql
                            ),
                            React.createElement("button", { 
                                onClick: () => { 
                                    navigator.clipboard.writeText(errorConfig.sql); 
                                    alert('SQL copied to clipboard!'); 
                                }, 
                                className: "self-start text-[10px] bg-white/10 hover:bg-white/20 py-1.5 px-3 rounded text-center font-bold uppercase tracking-wider transition-colors" 
                            }, "Copy SQL Code")
                        ),

                        React.createElement("div", { className: "p-2 sm:p-3 bg-[#202c33] flex items-center gap-2 shrink-0 z-30 safe-bottom border-t border-white/5" },
                            React.createElement("input", { type: "file", ref: fileInputRef, onChange: handleFileSelect, onClick: (e) => e.target.value = null, className: "hidden", accept: "image/*,application/pdf" }),
                            React.createElement("button", { 
                                type: "button", 
                                onClick: () => fileInputRef.current.click(), 
                                className: `p-2.5 rounded-full transition-all shrink-0 ${selectedFile ? 'bg-accent text-brandNav' : 'bg-[#2a3942] text-gray-400 hover:text-white hover:bg-[#3a4b55]'}`
                            }, React.createElement(Icons.PaperClip, null)),
                            
                            React.createElement("form", { onSubmit: handleSend, className: "flex-1 flex gap-2 relative" },
                                selectedFile && React.createElement("div", { className: "absolute -top-12 left-0 bg-[#202c33] border border-accent/30 text-accent text-xs px-3 py-1.5 rounded-lg shadow-lg flex items-center gap-2 animate-slide-in" },
                                    React.createElement("span", { className: "max-w-[200px] truncate" }, selectedFile.name),
                                    React.createElement("button", { type: "button", onClick: clearSelectedFile, className: "hover:text-white" }, React.createElement(Icons.Close, null))
                                ),
                                React.createElement("input", { 
                                    value: inputText, 
                                    onChange: e => setInputText(e.target.value), 
                                    className: "flex-1 bg-[#2a3942] px-4 py-2.5 rounded-full text-white text-sm outline-none min-h-[44px]", 
                                    placeholder: "Type a message"
                                }),
                                React.createElement("button", { 
                                    type: "submit", 
                                    disabled: (!inputText.trim() && !selectedFile) || uploading, 
                                    className: `p-2.5 rounded-full transition-all shrink-0 ${inputText.trim() || selectedFile ? 'bg-accent text-brandNav' : 'bg-tertiary text-gray-400'}` 
                                }, uploading ? '...' : React.createElement(Icons.Send, null))
                            )
                        )
                    )
                )
            );
        };

        const TaskManagement = ({ user, allEmployees }) => {
            const [tasks, setTasks] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({ title: '', description: '', priority: 'medium', assigned_to: '' });
            
            // START TASK REPLY FEATURE
            const [selectedTask, setSelectedTask] = useState(null);
            // END TASK REPLY FEATURE

            const fetchTasks = async () => {
                let query = supabase.from('tasks').select('*').order('created_at', { ascending: false });
                if (user.role === 'employee') query = query.eq('assigned_to', user.user_id);
                const { data } = await query;
                if (data) setTasks(data);
            };

            useEffect(() => { fetchTasks(); }, [user]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.title || !formData.assigned_to) return alert("Fill required fields.");
                setLoading(true);
                const { error } = await supabase.from('tasks').insert([{ ...formData, assigned_by: user.user_id, status: 'pending', message_type: 'task', created_at: new Date().toISOString() }]);
                if (error) alert(error.message);
                else { setShowModal(false); setFormData({ title: '', description: '', priority: 'medium', assigned_to: '' }); fetchTasks(); }
                setLoading(false);
            };

            return React.createElement("div", { className: "space-y-6 animate-fade-in pb-24" },
                React.createElement("div", { className: "flex justify-between items-center" },
                    React.createElement("h2", { className: "text-2xl font-bold text-white tracking-tight" }, "Tasks"),
                    user.role === 'admin' && React.createElement("button", { onClick: () => setShowModal(true), className: "bg-accent text-brandNav font-black px-6 py-2.5 rounded-xl text-sm shadow-lg active:scale-95 transition-all min-h-[44px]" }, "New Task")
                ),
                React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" },
                    tasks.length === 0 ? React.createElement("div", { className: "text-gray-500 p-20 col-span-full text-center border-2 border-dashed border-tertiary rounded-3xl" }, "No active tasks.") :
                    tasks.map(t => React.createElement("div", { key: t.id, onClick: () => setSelectedTask(t), className: "bg-secondary p-6 rounded-2xl border border-tertiary shadow-xl hover:border-accent/30 transition-all flex flex-col cursor-pointer active:scale-[0.98]" },
                        React.createElement("div", { className: "flex justify-between items-start mb-4" },
                           React.createElement("h3", { className: "font-bold text-white text-lg leading-tight" }, t.title),
                           React.createElement("span", { className: `text-[10px] font-black uppercase px-2 py-1 rounded-full ${t.priority === 'high' ? 'bg-danger/20 text-danger' : t.priority === 'medium' ? 'bg-warning/20 text-warning' : 'bg-success/20 text-success'}` }, t.priority)
                        ),
                        React.createElement("p", { className: "text-sm text-gray-400 mt-2 flex-1 line-clamp-3" }, t.description),
                        React.createElement("div", { className: "mt-6 pt-4 border-t border-tertiary flex justify-between items-center text-xs" },
                            React.createElement("span", { className: "text-accent uppercase font-black" }, `To: ${allEmployees.find(e=>e.user_id === t.assigned_to)?.name || t.assigned_to}`),
                            React.createElement("span", { className: "text-gray-600" }, new Date(t.created_at).toLocaleDateString())
                        )
                    ))
                ),
                showModal && React.createElement(Modal, { isOpen: showModal, onClose: () => setShowModal(false), title: "New Task" },
                    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
                        React.createElement("div", null, React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-2" }, "Title"), React.createElement("input", { required: true, value: formData.title, onChange: e => setFormData({...formData, title: e.target.value}), className: "modern-input", placeholder: "Task title" })),
                        React.createElement("div", null, React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-2" }, "Description"), React.createElement("textarea", { required: true, value: formData.description, onChange: e => setFormData({...formData, description: e.target.value}), className: "modern-input min-h-[100px] resize-none", placeholder: "Details..." })),
                        React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                            React.createElement("div", null, React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-2" }, "Priority"), React.createElement("select", { value: formData.priority, onChange: e => setFormData({...formData, priority: e.target.value}), className: "modern-input" }, React.createElement("option", { value: "low" }, "Low"), React.createElement("option", { value: "medium" }, "Medium"), React.createElement("option", { value: "high" }, "High"))),
                            React.createElement("div", null, React.createElement("label", { className: "block text-xs font-bold text-gray-500 uppercase mb-2" }, "Assign To"), React.createElement("select", { required: true, value: formData.assigned_to, onChange: e => setFormData({...formData, assigned_to: e.target.value}), className: "modern-input" }, React.createElement("option", { value: "" }, "Select Employee"), allEmployees.filter(e => e.role === 'employee').map(e => React.createElement("option", { key: e.user_id, value: e.user_id }, e.name))))
                        ),
                        React.createElement("button", { disabled: loading, type: "submit", className: "w-full bg-accent text-primary font-black py-4 rounded-xl shadow-lg mt-6" }, loading ? "Processing..." : "Assign Task")
                    )
                ),
                // START TASK REPLY FEATURE
                selectedTask && React.createElement(Modal, { isOpen: !!selectedTask, onClose: () => setSelectedTask(null), title: "Task Details" },
                    React.createElement("div", { className: "space-y-4" },
                        React.createElement("div", { className: "flex justify-between items-start" },
                            React.createElement("h3", { className: "text-xl font-bold text-white" }, selectedTask.title),
                            React.createElement("span", { className: `text-[10px] font-black uppercase px-2 py-1 rounded-full ${selectedTask.priority === 'high' ? 'bg-danger/20 text-danger' : selectedTask.priority === 'medium' ? 'bg-warning/20 text-warning' : 'bg-success/20 text-success'}` }, selectedTask.priority)
                        ),
                        React.createElement("p", { className: "text-sm text-gray-300 leading-relaxed whitespace-pre-wrap" }, selectedTask.description),
                        React.createElement("div", { className: "flex justify-between items-center text-[10px] text-gray-500 border-b border-tertiary pb-4" },
                            React.createElement("span", null, `Assigned By: ${allEmployees.find(e => e.user_id === selectedTask.assigned_by)?.name || 'Admin'}`),
                            React.createElement("span", null, new Date(selectedTask.created_at).toLocaleDateString())
                        ),
                        React.createElement(TaskReplies, { taskId: selectedTask.id, user: user, allEmployees: allEmployees })
                    )
                )
                // END TASK REPLY FEATURE
            );
        };

        const UserProfile = ({ user, onUpdate }) => {
            const [form, setForm] = useState(user);
            const handleSave = async () => {
                const { error } = await supabase.from('user_profiles').update({ name: form.name, mobile_no: form.mobile_no, password: form.password }).eq('user_id', user.user_id);
                if (error) alert(error.message); else { alert('Profile updated.'); onUpdate({ ...user, ...form }); }
            };
            return React.createElement("div", { className: "max-w-2xl mx-auto bg-secondary p-6 sm:p-10 rounded-3xl border border-tertiary shadow-xl animate-fade-in overflow-y-auto custom-scrollbar pb-24" },
                React.createElement("div", { className: "flex flex-col items-center gap-6 mb-12" },
                    React.createElement("div", { className: "w-24 h-24 rounded-full border-4 border-accent p-1" }, 
                        React.createElement("img", { src: user.photo_url || `https://picsum.photos/seed/${user.user_id}/200/200`, className: "w-full h-full rounded-full object-cover" })
                    ),
                    React.createElement("div", { className: "text-center" }, React.createElement("h2", { className: "text-2xl font-bold text-white tracking-tight" }, user.name), React.createElement("p", { className: "text-accent text-xs font-black uppercase mt-1 tracking-widest" }, user.user_id))
                ),
                React.createElement("div", { className: "space-y-6" },
                    React.createElement("div", null, React.createElement("label", { className: "text-xs font-bold text-gray-500 uppercase block mb-2" }, "Full Name"), React.createElement("input", { value: form.name, onChange: e => setForm({ ...form, name: e.target.value }), className: "modern-input" })),
                    React.createElement("div", null, React.createElement("label", { className: "text-xs font-bold text-gray-500 uppercase block mb-2" }, "Mobile"), React.createElement("input", { value: form.mobile_no, onChange: e => setForm({ ...form, mobile_no: e.target.value }), className: "modern-input" })),
                    React.createElement("div", null, React.createElement("label", { className: "text-xs font-bold text-gray-500 uppercase block mb-2" }, "Change Password"), React.createElement("input", { type: "password", value: form.password, onChange: e => setForm({ ...form, password: e.target.value }), className: "modern-input" }))
                ),
                React.createElement("button", { onClick: handleSave, className: "w-full bg-accent text-primary font-black px-10 py-4 rounded-xl shadow-lg mt-10" }, "Update Profile")
            );
        };

        const EmployeeTracker = ({ isOpen, onClose, employees }) => {
            const [selectedEmp, setSelectedEmp] = useState('');
            const [logs, setLogs] = useState([]);
            
            const fetchLogs = useCallback(async () => {
                if (!selectedEmp) return;
                const { data } = await supabase.from('daily_activity').select('*').eq('user_id', selectedEmp).order('created_at', { ascending: false }).limit(50);
                if (data) setLogs(data);
            }, [selectedEmp]);

            useEffect(() => { if (selectedEmp) { fetchLogs(); const itv = setInterval(fetchLogs, 15000); return () => clearInterval(itv); } }, [selectedEmp, fetchLogs]);

            if (!isOpen) return null;
            const path = logs.filter(l => l.latitude && l.longitude).map(l => ({ lat: l.latitude, lng: l.longitude })).reverse();
            const current = path[path.length - 1];

            return React.createElement("div", { className: "fixed inset-0 z-[100] bg-primary flex flex-col animate-fade-in" },
                React.createElement("header", { className: "p-4 bg-brandNav border-b border-tertiary flex justify-between items-center shadow-lg z-20" },
                    React.createElement("div", { className: "flex items-center gap-4" },
                        React.createElement("button", { onClick: onClose, className: "p-2 bg-tertiary hover:bg-gray-600 rounded-full text-white" }, React.createElement(Icons.Close, null)),
                        React.createElement("h2", { className: "text-white font-bold tracking-wide" }, "Live Tracking")
                    ),
                    React.createElement("select", { value: selectedEmp, onChange: e => setSelectedEmp(e.target.value), className: "bg-primary border border-tertiary p-2 rounded-lg text-white text-sm outline-none w-40 sm:w-48" },
                        React.createElement("option", { value: "" }, "Select User"),
                        employees.map(e => React.createElement("option", { key: e.user_id, value: e.user_id }, e.name))
                    )
                ),
                React.createElement("div", { className: "flex-1 relative bg-secondary" }, 
                    !selectedEmp ? React.createElement("div", { className: "absolute inset-0 flex items-center justify-center text-gray-500" }, "Select an employee") : 
                    React.createElement(MapComponent, { lat: current?.lat || 0, lng: current?.lng || 0, pathCoordinates: path, active: true })
                )
            );
        };

        // --- MAIN APP SHELL ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [section, setSection] = useState('dashboard');
            const [mobileNavOpen, setMobileNavOpen] = useState(false);
            const [showTrackerModal, setShowTrackerModal] = useState(false);
            const [employeeList, setEmployeeList] = useState([]);

            const fetchEmployees = useCallback(async () => {
                const { data } = await supabase.from('user_profiles').select('*').order('name');
                if (data) setEmployeeList(data);
            }, []);

            useEffect(() => {
                const saved = localStorage.getItem('current_user_session');
                if (saved) try { setUser(JSON.parse(saved)); } catch { localStorage.removeItem('current_user_session'); }
            }, []);

            useEffect(() => { if (user) fetchEmployees(); }, [user, fetchEmployees]);

            const navigate = (id) => { setSection(id); setMobileNavOpen(false); window.scrollTo(0,0); };
            
            const logout = async () => { 
                if (user) await supabase.from('user_profiles').update({ is_online: false }).eq('user_id', user.user_id);
                setUser(null); 
                localStorage.removeItem('current_user_session'); 
            };

            if (!user) return React.createElement(Login, { onLogin: u => { setUser(u); localStorage.setItem('current_user_session', JSON.stringify(u)); } });

            const NavItem = ({ id, icon: Icon, label }) => React.createElement("button", { onClick: () => navigate(id), className: `w-full flex items-center gap-3 px-4 py-3.5 rounded-2xl transition-all ${section === id ? 'bg-accent text-brandNav font-bold shadow-lg shadow-accent/20' : 'text-gray-400 hover:text-white hover:bg-white/5'}` },
                React.createElement(Icon, null), React.createElement("span", { className: "text-sm tracking-tight" }, label)
            );

            return React.createElement("div", { className: "flex flex-col lg:flex-row min-h-screen bg-primary text-slate-200" },
                // Mobile Header
                React.createElement("header", { className: "lg:hidden bg-brandNav p-4 flex justify-between items-center border-b border-white/5 z-30 shrink-0 h-16" },
                    React.createElement("div", { className: "flex items-center gap-2" }, React.createElement(Icons.Rocket, null), React.createElement("h1", { className: "text-xl font-black text-accent tracking-tighter" }, "TRACKER")),
                    React.createElement("button", { onClick: () => setMobileNavOpen(!mobileNavOpen), className: "text-accent p-2" }, React.createElement(Icons.Menu, null))
                ),
                
                // Sidebar (Desktop Static, Mobile Drawer)
                React.createElement(React.Fragment, null,
                    React.createElement("div", { onClick: () => setMobileNavOpen(false), className: `fixed inset-0 bg-black/60 z-40 lg:hidden transition-opacity ${mobileNavOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}` }),
                    React.createElement("aside", { className: `fixed inset-y-0 left-0 w-72 bg-brandNav border-r border-white/5 flex flex-col p-6 z-50 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-auto lg:h-full ${mobileNavOpen ? 'translate-x-0' : '-translate-x-full'}` },
                        React.createElement("div", { className: "flex justify-between items-center mb-10" },
                            React.createElement("div", { className: "hidden lg:flex items-center gap-2" }, React.createElement(Icons.Rocket, null), React.createElement("h1", { className: "text-2xl font-black text-accent tracking-tighter" }, "TRACKER")),
                            React.createElement("button", { onClick: () => setMobileNavOpen(false), className: "lg:hidden text-gray-500" }, React.createElement(Icons.Close, null))
                        ),
                        React.createElement("div", { className: "flex-1 space-y-2 overflow-y-auto custom-scrollbar pr-2" },
                            React.createElement(NavItem, { id: "dashboard", icon: Icons.Dashboard, label: "Dashboard" }),
                            React.createElement(NavItem, { id: "activity", icon: Icons.Activity, label: "Activity" }),
                            React.createElement(NavItem, { id: "tasks", icon: Icons.ClipboardList, label: "Tasks" }),
                            React.createElement(NavItem, { id: "chat", icon: Icons.Chat, label: "Chat" }),
                            React.createElement(NavItem, { id: "followups", icon: Icons.FollowUp, label: "Follow-ups" }),
                            React.createElement(NavItem, { id: "profile", icon: Icons.Profile, label: "Profile" }),
                            user.role === 'admin' && React.createElement("div", { className: "pt-4 mt-4 border-t border-white/5 space-y-2" },
                                React.createElement("p", { className: "text-[10px] font-black text-gray-500 uppercase tracking-widest px-4 mb-2" }, "Admin Panel"),
                                React.createElement(NavItem, { id: "manage-emp", icon: Icons.Users, label: "Employees" }),
                                React.createElement(NavItem, { id: "manage-admin", icon: Icons.Admin, label: "Admins" }),
                                React.createElement("button", { onClick: () => { setShowTrackerModal(true); setMobileNavOpen(false); }, className: "w-full flex items-center gap-3 px-4 py-3.5 text-accent font-black hover:bg-accent/10 rounded-2xl transition-all" }, React.createElement(Icons.Map, null), "Live Track")
                            )
                        ),
                        React.createElement("button", { onClick: logout, className: "w-full p-4 bg-danger/10 text-danger rounded-2xl font-bold text-xs uppercase tracking-widest hover:bg-danger/20 transition-all flex items-center justify-center gap-2" }, "Sign Out")
                    )
                ),

                // Main Content Area
                React.createElement("main", { className: "flex-1 relative z-10 custom-scrollbar bg-primary flex flex-col" },
                    React.createElement("div", { 
                        className: `
                            max-w-7xl mx-auto w-full flex-1
                            ${section === 'chat' 
                                ? 'h-full !p-0 flex flex-col overflow-hidden' 
                                : 'p-4 lg:p-8 overflow-y-auto'
                            }`
                    },
                        section === 'dashboard' && React.createElement(Dashboard, { user }),
                        section === 'activity' && React.createElement(DailyActivity, { user, allEmployees: employeeList }),
                        section === 'tasks' && React.createElement(TaskManagement, { user, allEmployees: employeeList }),
                        section === 'chat' && React.createElement(ChatSystem, { user, allUsers: employeeList }),
                        section === 'followups' && React.createElement(FollowUps, { user }),
                        section === 'profile' && React.createElement(UserProfile, { user, onUpdate: setUser }),
                        section === 'manage-emp' && React.createElement(AdminManagement, { type: "employee" }),
                        section === 'manage-admin' && React.createElement(AdminManagement, { type: "admin" })
                    )
                ),
                showTrackerModal && React.createElement(EmployeeTracker, { isOpen: showTrackerModal, onClose: () => setShowTrackerModal(false), employees: employeeList })
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
